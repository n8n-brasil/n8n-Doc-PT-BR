# Criação de Dados de Teste

A criação de dados de teste (mocking) é essencial para desenvolver e testar workflows sem depender de dados reais ou APIs externas. Esta seção aborda como gerar dados sintéticos realistas para diferentes cenários de teste.

## Visão Geral

Dados de teste permitem desenvolver workflows de forma segura e eficiente, simulando cenários reais sem comprometer dados de produção ou sistemas externos. O n8n oferece ferramentas integradas e suporte para bibliotecas externas de geração de dados.

## Tipos de Dados de Teste

### Dados Pessoais

Gere dados pessoais realistas para testes:

```javascript
// Gerar dados de usuário brasileiro
;
};

// Gerar CPF válido
, () => Math.floor(Math.random() * 10));
  
  // Calcular primeiro dígito verificador
  let soma = 0;
  for (let i = 0; i < 9; i++) {
    soma += numeros[i] * (10 - i);
  }
  const digito1 = ((soma * 10) % 11) % 10;
  numeros.push(digito1);
  
  // Calcular segundo dígito verificador
  soma = 0;
  for (let i = 0; i < 10; i++) {
    soma += numeros[i] * (11 - i);
  }
  const digito2 = ((soma * 10) % 11) % 10;
  numeros.push(digito2);
  
  return numeros.join('');
};
```

### Dados Comerciais

Crie dados de negócios para testes:

```javascript
// Gerar dados de empresa brasileira
;
};

// Gerar CNPJ válido
, () => Math.floor(Math.random() * 10));
  
  // Calcular primeiro dígito verificador
  const pesos1 = [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
  let soma = 0;
  for (let i = 0; i < 12; i++) {
    soma += numeros[i] * pesos1[i];
  }
  const digito1 = ((soma * 10) % 11) % 10;
  numeros.push(digito1);
  
  // Calcular segundo dígito verificador
  const pesos2 = [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
  soma = 0;
  for (let i = 0; i < 13; i++) {
    soma += numeros[i] * pesos2[i];
  }
  const digito2 = ((soma * 10) % 11) % 10;
  numeros.push(digito2);
  
  return numeros.join('');
};
```

### Dados Financeiros

Simule dados financeiros para testes:

```javascript
// Gerar dados de transação financeira
;
};

// Gerar dados de fatura
, () => ({
    descricao: ['Produto A', 'Serviço B', 'Item C'][Math.floor(Math.random() * 3)],
    quantidade: Math.floor(Math.random() * 10) + 1,
    precoUnitario: (Math.random() * 100).toFixed(2)
  }));
  
  const subtotal = itens.reduce((acc, item) => 
    acc + (item.quantidade * parseFloat(item.precoUnitario)), 0);
  
  return {
    numero: gerarNumeroFatura(),
    dataEmissao: new Date().toISOString(),
    vencimento: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
    cliente: gerarUsuarioBR(),
    itens: itens,
    subtotal: subtotal.toFixed(2),
    impostos: (subtotal * 0.18).toFixed(2),
    total: (subtotal * 1.18).toFixed(2)
  };
};
```

## Bibliotecas de Mocking

### Faker.js

Use a biblioteca Faker.js para dados realistas:

```javascript
// Configurar Faker.js para português brasileiro
const { faker } = require('@faker-js/faker/locale/pt_BR');

// Gerar dados de pessoa
const pessoa = {
  nome: faker.person.fullName(),
  email: faker.internet.email(),
  telefone: faker.phone.number('(##) #####-####'),
  cpf: faker.helpers.replaceSymbolWithNumber('###.###.###-##'),
  endereco: {
    rua: faker.location.street(),
    numero: faker.location.buildingNumber(),
    bairro: faker.location.county(),
    cidade: faker.location.city(),
    estado: faker.location.state(),
    cep: faker.location.zipCode('#####-###')
  }
};

// Gerar dados de empresa
const empresa = {
  razaoSocial: faker.company.name(),
  cnpj: faker.helpers.replaceSymbolWithNumber('##.###.###/####-##'),
  email: faker.internet.email(),
  website: faker.internet.url(),
  setor: faker.company.buzzNoun()
};
```

### Chance.js

Use Chance.js para dados mais específicos:

```javascript
const Chance = require('chance');
const chance = new Chance();

// Gerar dados específicos
const dadosEspecificos = {
  // Dados brasileiros
  cpf: chance.cpf(),
  cnpj: chance.cnpj(),
  telefone: chance.phone({ country: 'br' }),
  cep: chance.zip(),
  
  // Dados de negócio
  empresa: chance.company(),
  profissao: chance.profession(),
  salario: chance.integer({ min: 1000, max: 50000 }),
  
  // Dados de localização
  cidade: chance.city(),
  estado: chance.state({ full: true }),
  pais: 'Brasil'
};
```

## Cenários de Teste Comuns

### E-commerce

```javascript
// Gerar dados de e-commerce
, () => ({
        produto: gerarProduto(),
        quantidade: Math.floor(Math.random() * 5) + 1,
        preco: (Math.random() * 500).toFixed(2)
      })),
      enderecoEntrega: gerarEnderecoBR(),
      formaPagamento: ['Cartão', 'PIX', 'Boleto'][Math.floor(Math.random() * 3)]
    }
  };
};

;
};
```

### CRM

```javascript
// Gerar dados de CRM
,
    oportunidades: Array.from({length: Math.floor(Math.random() * 3) + 1}, () => ({
      id: gerarUUID(),
      titulo: faker.company.catchPhrase(),
      valor: (Math.random() * 50000).toFixed(2),
      probabilidade: Math.floor(Math.random() * 100),
      etapa: ['Prospecção', 'Qualificação', 'Proposta', 'Negociação', 'Fechamento'][Math.floor(Math.random() * 5)]
    }))
  };
};
```

### ERP

```javascript
// Gerar dados de ERP
)),
      estoque: Math.floor(Math.random() * 1000),
      fornecedor: faker.company.name()
    },
    fornecedor: {
      codigo: gerarCodigoFornecedor(),
      razaoSocial: faker.company.name(),
      cnpj: faker.helpers.replaceSymbolWithNumber('##.###.###/####-##'),
      contato: faker.person.fullName(),
      email: faker.internet.email(),
      telefone: faker.phone.number()
    },
    cliente: {
      codigo: gerarCodigoCliente(),
      nome: faker.person.fullName(),
      tipo: ['PF', 'PJ'][Math.floor(Math.random() * 2)],
      documento: Math.random() > 0.5 ? faker.helpers.replaceSymbolWithNumber('###.###.###-##') : faker.helpers.replaceSymbolWithNumber('##.###.###/####-##'),
      email: faker.internet.email(),
      telefone: faker.phone.number()
    }
  };
};
```

## Workflows de Teste

### Workflow: Geração de Dados de Teste

```mermaid
graph TD
    A[Manual Trigger] --> B[Code: Gerar Dados]
    B --> C[Split In Batches]
    C --> D[HTTP Request: API Externa]
    D --> E[Validate Data]
    E --> F[Save to Database]
    F --> G[Send Notification]
    G --> H[Next Batch]
    H --> D
```

### Workflow: Teste de Performance

```mermaid
graph TD
    A[Schedule Trigger] --> B[Code: Gerar Carga]
    B --> C[HTTP Request: Load Test]
    C --> D[Monitor Performance]
    D --> E[Log Results]
    E --> F[Generate Report]
    F --> G[Send Alert if Issues]
```

## Configuração de Ambiente de Teste

### Variáveis de Ambiente

```bash
# Configurar ambiente de teste
export N8N_ENVIRONMENT=test
export N8N_DATABASE_URL=postgresql://test:test@localhost:5432/n8n_test
export N8N_MOCK_DATA_ENABLED=true
export N8N_TEST_API_URL=https://api-test.exemplo.com
```

### Configuração de Dados de Teste

```javascript
// Configurar dados de teste
,
    
    // Configurações de dados
    dados: {
      incluirDadosSensiveis: false,
      mascararDados: true,
      usarDadosRealistas: true
    },
    
    // Configurações de API
    api: {
      url: process.env.N8N_TEST_API_URL,
      timeout: 5000,
      retryAttempts: 3
    }
  };
};
```

## Validação de Dados de Teste

### Validação de Formato

```javascript
// Validar formato de dados brasileiros

  
  // Validar CNPJ
  if (dados.cnpj && !validarCNPJ(dados.cnpj)) {
    erros.push('CNPJ inválido');
  }
  
  // Validar email
  if (dados.email && !validarEmail(dados.email)) {
    erros.push('Email inválido');
  }
  
  // Validar telefone
  if (dados.telefone && !validarTelefone(dados.telefone)) {
    erros.push('Telefone inválido');
  }
  
  return {
    valido: erros.length === 0,
    erros: erros
  };
};

// Validar CPF
$/.test(cpf)) return false;
  
  // Calcular dígitos verificadores
  let soma = 0;
  for (let i = 0; i < 9; i++) {
    soma += parseInt(cpf[i]) * (10 - i);
  }
  const digito1 = ((soma * 10) % 11) % 10;
  
  soma = 0;
  for (let i = 0; i < 10; i++) {
    soma += parseInt(cpf[i]) * (11 - i);
  }
  const digito2 = ((soma * 10) % 11) % 10;
  
  return parseInt(cpf[9]) === digito1 && parseInt(cpf[10]) === digito2;
};
```

### Validação de Consistência

```javascript
// Validar consistência de dados

  
  // Verificar se pedido tem itens
  if (dados.pedido && (!dados.pedido.itens || dados.pedido.itens.length === 0)) {
    inconsistencias.push('Pedido sem itens');
  }
  
  // Verificar se valores são positivos
  if (dados.valor && parseFloat(dados.valor) <= 0) {
    inconsistencias.push('Valor deve ser positivo');
  }
  
  return {
    consistente: inconsistencias.length === 0,
    inconsistencias: inconsistencias
  };
};
```

## Boas Práticas

### Segurança

- **Nunca use dados reais** em ambiente de teste
- **Mascare dados sensíveis** sempre que possível
- **Use dados sintéticos** realistas mas não identificáveis
- **Limpe dados de teste** regularmente
- **Isole ambiente de teste** da produção

### Qualidade

- **Valide dados gerados** antes do uso
- **Mantenha consistência** entre diferentes tipos de dados
- **Use padrões realistas** para o contexto brasileiro
- **Documente formatos** de dados esperados
- **Teste com diferentes volumes** de dados

### Performance

- **Gere dados em lotes** para grandes volumes
- **Use cache** para dados frequentemente acessados
- **Otimize geração** de dados complexos
- **Monitore uso de memória** durante geração
- **Limpe dados antigos** regularmente

## Recursos Adicionais

### Bibliotecas Úteis

- **Faker.js**: Geração de dados realistas
- **Chance.js**: Dados mais específicos e controlados
- **JSON Schema Faker**: Baseado em schemas JSON
- **TestData-Generator**: Dados estruturados

### Ferramentas de Teste

- **Postman**: Testes de API com dados mock
- **Insomnia**: Alternativa ao Postman
- **JMeter**: Testes de carga
- **Artillery**: Testes de performance

---

**Próximo**: [Visualização de Schema](./schema-preview) - Entenda a estrutura dos dados 
