---
sidebar_position: 3
title: Backup e Recovery
description: Como implementar estratégias de backup e recuperação para n8n
keywords: [n8n, backup, recovery, restauração, continuidade, dados]
---


#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-e Recovery

Este documento ensina como **implementar backup e recovery** para n8n, incluindo backup automático de workflows, export/import de credenciais, versionamento de configurações, recuperação point-in-time, testes de restauração, e estratégias de disaster recovery que garantem proteção completa dos dados críticos e continuidade operacional mesmo em cenários catastróficos de perda de dados ou infraestrutura.

#ionicicon-nameschool-outline-style-fontsize-24px color: '#cor-ea4b71-o-que você vai aprender

- Estratégias de backup 3-2-1
- Scripts de automação
- Recuperação point-in-time
- Disaster recovery
- Testes de restauração

---

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-estratgia-de Backup 3-2-1

#princpio-3-2-1

#cor-definio-da-estratgia-3 cópias** dos dados (original + 2 backups)
- **2 tipos** de mídia diferentes (disco + nuvem)
- **1 cópia** fora do local (backup remoto)

#implementao-bash
#ionicicon-namefolder-outline-style-fontsize-24px color: '#cor-ea4b71-estrutura-de backup 3-2-1
/backups/n8n/
├── local/                    #cor-backup-local-disco daily/               #cor-backups-dirios-weekly              #cor-backups-semanais-monthly             #cor-backups-mensais-cloud                   #cor-backup-na-nuvem s3/                  #amazon-s3-gcs                 #google-cloud-storage azure/               #azure-blob-storage-offsite                 #cor-backup-fora-do-local remote-server/       #servidor-remoto-tape                #fita-se-aplicvel

#ionicicon-nameanalytics-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de Banco de Dados

#PostgreSQL

#script-de-backup-postgresql-bash
#bin/bash
#ionicicon-nameserver-outline-style-fontsize-24px color: '#cor-ea4b71-backup-postgressh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-dbhostlocalhost
DB_PORT="5432"
DB_NAME="n8n"
DB_USER="n8n"
DB_PASSWORD="senha_banco"
BACKUP_DIR="/backups/n8n/database"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/n8n_db_$DATE.sql"
RETENTION_DAYS=30

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-criar-diretrio se não existir
mkdir -p $BACKUP_DIR

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-completo
echo "Iniciando backup do PostgreSQL..."
pg_dump -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME > $BACKUP_FILE

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o backup foi bem-sucedido
if [ $? -eq 0 ]; then
    echo "Backup criado com sucesso: $BACKUP_FILE"
    
    #comprimir-backup-gzip-backupfile-echo "Backup comprimido: $BACKUP_FILE.gz"
    
    #calcular-tamanho-do-backup-backupsizedu -h "$BACKUP_FILE.gz" | cut -f1)
    echo "Tamanho do backup: $BACKUP_SIZE"
    
    #remover-backups-antigos-find-backupdir -name "*.sql.gz" -mtime +$RETENTION_DAYS -delete
    echo "Backups antigos removidos (mais de $RETENTION_DAYS dias)"
    
    #log-do-backup-echo-date Backup PostgreSQL criado - $BACKUP_FILE.gz ($BACKUP_SIZE)" >> /var/log/n8n/backup.log
    
else
    echo "ERRO: Falha no backup do PostgreSQL"
    exit 1
fi
```

#cor-backup-incremental-bash
#bin/bash
#ionicicon-nameserver-outline-style-fontsize-24px color: '#cor-ea4b71-backup-postgres-incrementalsh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-dbhostlocalhost
DB_PORT="5432"
DB_NAME="n8n"
DB_USER="n8n"
BACKUP_DIR="/backups/n8n/database/incremental"
DATE=$(date +%Y%m%d_%H%M%S)

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-incremental usando WAL
pg_basebackup -h $DB_HOST -p $DB_PORT -U $DB_USER \
  -D $BACKUP_DIR/base_$DATE \
  -Ft -z -P

echo "Backup incremental criado: $BACKUP_DIR/base_$DATE"
```

#MySQL

#script-de-backup-mysql-bash
#bin/bash
#ionicicon-nameserver-outline-style-fontsize-24px color: '#cor-ea4b71-backup-mysqlsh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-dbhostlocalhost
DB_PORT="3306"
DB_NAME="n8n"
DB_USER="n8n"
DB_PASSWORD="senha_banco"
BACKUP_DIR="/backups/n8n/database"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/n8n_db_$DATE.sql"
RETENTION_DAYS=30

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-criar-diretrio se não existir
mkdir -p $BACKUP_DIR

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-completo
echo "Iniciando backup do MySQL..."
mysqldump -h $DB_HOST -P $DB_PORT -u $DB_USER -p$DB_PASSWORD \
  --single-transaction \
  --routines \
  --triggers \
  --events \
  $DB_NAME > $BACKUP_FILE

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o backup foi bem-sucedido
if [ $? -eq 0 ]; then
    echo "Backup criado com sucesso: $BACKUP_FILE"
    
    #comprimir-backup-gzip-backupfile-echo "Backup comprimido: $BACKUP_FILE.gz"
    
    #calcular-tamanho-do-backup-backupsizedu -h "$BACKUP_FILE.gz" | cut -f1)
    echo "Tamanho do backup: $BACKUP_SIZE"
    
    #remover-backups-antigos-find-backupdir -name "*.sql.gz" -mtime +$RETENTION_DAYS -delete
    echo "Backups antigos removidos (mais de $RETENTION_DAYS dias)"
    
    #log-do-backup-echo-date Backup MySQL criado - $BACKUP_FILE.gz ($BACKUP_SIZE)" >> /var/log/n8n/backup.log
    
else
    echo "ERRO: Falha no backup do MySQL"
    exit 1
fi
```

---

#ionicicon-nameshield-checkmark-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de Workflows e Credenciais

#cor-backup-via-api

#script-de-backup-de-workflows

```bash
#bin/bash
#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-backup-workflowssh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-n8nurlhttpsseu-n8ncom
API_KEY="sua_api_key"
BACKUP_DIR="/backups/n8n/workflows"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/workflows_$DATE.json"
RETENTION_DAYS=30

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-criar-diretrio se não existir
mkdir -p $BACKUP_DIR

#ionicicon-namecode-slash-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de workflows via API
echo "Iniciando backup de workflows..."
curl -H "X-N8N-API-KEY: $API_KEY" \
  "$N8N_URL/api/v1/workflows" \
  | jq '.' > $BACKUP_FILE

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o backup foi bem-sucedido
if [ $? -eq 0 ]; then
    echo "Backup de workflows criado: $BACKUP_FILE"
    
    #comprimir-backup-gzip-backupfile-echo "Backup comprimido: $BACKUP_FILE.gz"
    
    #calcular-tamanho-do-backup-backupsizedu -h "$BACKUP_FILE.gz" | cut -f1)
    echo "Tamanho do backup: $BACKUP_SIZE"
    
    #remover-backups-antigos-find-backupdir -name "*.json.gz" -mtime +$RETENTION_DAYS -delete
    echo "Backups antigos removidos (mais de $RETENTION_DAYS dias)"
    
    #log-do-backup-echo-date Backup de workflows criado - $BACKUP_FILE.gz ($BACKUP_SIZE)" >> /var/log/n8n/backup.log
    
else
    echo "ERRO: Falha no backup de workflows"
    exit 1
fi
```

#script-de-backup-de-credenciais

```bash
#bin/bash
#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-backup-credentialssh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-n8nurlhttpsseu-n8ncom
API_KEY="sua_api_key"
BACKUP_DIR="/backups/n8n/credentials"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/credentials_$DATE.json"
RETENTION_DAYS=30

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-criar-diretrio se não existir
mkdir -p $BACKUP_DIR

#ionicicon-namecode-slash-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de credenciais via API
echo "Iniciando backup de credenciais..."
curl -H "X-N8N-API-KEY: $API_KEY" \
  "$N8N_URL/api/v1/credentials" \
  | jq '.' > $BACKUP_FILE

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o backup foi bem-sucedido
if [ $? -eq 0 ]; then
    echo "Backup de credenciais criado: $BACKUP_FILE"
    
    #comprimir-backup-gzip-backupfile-echo "Backup comprimido: $BACKUP_FILE.gz"
    
    #calcular-tamanho-do-backup-backupsizedu -h "$BACKUP_FILE.gz" | cut -f1)
    echo "Tamanho do backup: $BACKUP_SIZE"
    
    #remover-backups-antigos-find-backupdir -name "*.json.gz" -mtime +$RETENTION_DAYS -delete
    echo "Backups antigos removidos (mais de $RETENTION_DAYS dias)"
    
    #log-do-backup-echo-date Backup de credenciais criado - $BACKUP_FILE.gz ($BACKUP_SIZE)" >> /var/log/n8n/backup.log
    
else
    echo "ERRO: Falha no backup de credenciais"
    exit 1
fi
```

#cor-backup-de-volumes-docker

#script-de-backup-de-volumes

```bash
#bin/bash
#ionicicon-namecloud-outline-style-fontsize-24px color: '#cor-ea4b71-backup-docker-volumessh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-volumenamen8ndata
BACKUP_DIR="/backups/n8n/volumes"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/n8n_volume_$DATE.tar.gz"
RETENTION_DAYS=30

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-criar-diretrio se não existir
mkdir -p $BACKUP_DIR

#ionicicon-nameperson-outline-style-fontsize-24px color: '#cor-ea4b71-parar-container n8n
echo "Parando container n8n..."
docker stop n8n

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-do volume
echo "Iniciando backup do volume Docker..."
docker run --rm -v $VOLUME_NAME:/data -v $BACKUP_DIR:/backup \
  alpine tar czf /backup/n8n_volume_$DATE.tar.gz -C /data .

#ionicicon-nameperson-outline-style-fontsize-24px color: '#cor-ea4b71-reiniciar-container n8n
echo "Reiniciando container n8n..."
docker start n8n

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o backup foi bem-sucedido
if [ $? -eq 0 ]; then
    echo "Backup do volume criado: $BACKUP_FILE"
    
    #calcular-tamanho-do-backup-backupsizedu -h "$BACKUP_FILE" | cut -f1)
    echo "Tamanho do backup: $BACKUP_SIZE"
    
    #remover-backups-antigos-find-backupdir -name "*.tar.gz" -mtime +$RETENTION_DAYS -delete
    echo "Backups antigos removidos (mais de $RETENTION_DAYS dias)"
    
    #log-do-backup-echo-date Backup de volume criado - $BACKUP_FILE ($BACKUP_SIZE)" >> /var/log/n8n/backup.log
    
else
    echo "ERRO: Falha no backup do volume"
    exit 1
fi
```

---

#ionicicon-namecloud-outline-style-fontsize-24px color: '#cor-ea4b71-backup-na Nuvem

#amazon-s3

#script-de-backup-para-s3

```bash
#bin/bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-to-s3sh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-s3bucketn8n-backups
S3_REGION="us-east-1"
BACKUP_DIR="/backups/n8n"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=90

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-completo para S3
echo "Iniciando backup para S3..."

#ionicicon-nameanalytics-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de banco de dados
aws s3 cp $BACKUP_DIR/database/n8n_db_$DATE.sql.gz \
  s3://$S3_BUCKET/database/n8n_db_$DATE.sql.gz \
  --region $S3_REGION

#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de workflows
aws s3 cp $BACKUP_DIR/workflows/workflows_$DATE.json.gz \
  s3://$S3_BUCKET/workflows/workflows_$DATE.json.gz \
  --region $S3_REGION

#ionicicon-nameshield-checkmark-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de credenciais
aws s3 cp $BACKUP_DIR/credentials/credentials_$DATE.json.gz \
  s3://$S3_BUCKET/credentials/credentials_$DATE.json.gz \
  --region $S3_REGION

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de volumes
aws s3 cp $BACKUP_DIR/volumes/n8n_volume_$DATE.tar.gz \
  s3://$S3_BUCKET/volumes/n8n_volume_$DATE.tar.gz \
  --region $S3_REGION

#ionicicon-namesettings-outline-style-fontsize-24px color: '#cor-ea4b71-configurar-lifecycle para remoção automática
aws s3api put-bucket-lifecycle-configuration \
  --bucket $S3_BUCKET \
  --lifecycle-configuration '{
    "Rules": [
      {
        "ID": "DeleteOldBackups",
        "Status": "Enabled",
        "Filter": {
          "Prefix": ""
        },
        "Expiration": {
          "Days": '$RETENTION_DAYS'
        }
      }
    ]
  }'

echo "Backup para S3 concluído"
```

#google-cloud-storage

#script-de-backup-para-gcs

```bash
#bin/bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-to-gcssh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-gcsbucketn8n-backups
BACKUP_DIR="/backups/n8n"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=90

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-completo para GCS
echo "Iniciando backup para Google Cloud Storage..."

#ionicicon-nameanalytics-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de banco de dados
gsutil cp $BACKUP_DIR/database/n8n_db_$DATE.sql.gz \
  gs://$GCS_BUCKET/database/n8n_db_$DATE.sql.gz

#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de workflows
gsutil cp $BACKUP_DIR/workflows/workflows_$DATE.json.gz \
  gs://$GCS_BUCKET/workflows/workflows_$DATE.json.gz

#ionicicon-nameshield-checkmark-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de credenciais
gsutil cp $BACKUP_DIR/credentials/credentials_$DATE.json.gz \
  gs://$GCS_BUCKET/credentials/credentials_$DATE.json.gz

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de volumes
gsutil cp $BACKUP_DIR/volumes/n8n_volume_$DATE.tar.gz \
  gs://$GCS_BUCKET/volumes/n8n_volume_$DATE.tar.gz

#ionicicon-namesettings-outline-style-fontsize-24px color: '#cor-ea4b71-configurar-lifecycle para remoção automática
gsutil lifecycle set lifecycle.json gs://$GCS_BUCKET

echo "Backup para GCS concluído"
```

---

#ionicicon-namechevron-forward-outline-style-fontsize-24px color: '#cor-ea4b71-recuperao-e Restauração

#restaurao-postgresql

#script-de-restaurao-bash
#bin/bash
#ionicicon-nameserver-outline-style-fontsize-24px color: '#cor-ea4b71-restore-postgressh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-dbhostlocalhost
DB_PORT="5432"
DB_NAME="n8n"
DB_USER="n8n"
BACKUP_FILE="$1"

if [ -z "$BACKUP_FILE" ]; then
    echo "Uso: $0 <arquivo_backup>"
    exit 1
fi

#ionicicon-namegrid-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o arquivo existe
if [ ! -f "$BACKUP_FILE" ]; then
    echo "ERRO: Arquivo de backup não encontrado: $BACKUP_FILE"
    exit 1
fi

echo "Iniciando restauração do PostgreSQL..."

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-parar-n8n
echo "Parando n8n..."
docker stop n8n

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-fazer-backup antes da restauração
echo "Criando backup de segurança..."
pg_dump -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME > \
  /backups/n8n/pre_restore_backup_$(date +%Y%m%d_%H%M%S).sql

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-descomprimir-backup se necessário
if [[ "$BACKUP_FILE" == *.gz ]]; then
    echo "Descomprimindo backup..."
    gunzip -c "$BACKUP_FILE" > "${BACKUP_FILE%.gz}"
    BACKUP_FILE="${BACKUP_FILE%.gz}"
fi

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-restaurar-backup
echo "Restaurando backup..."
psql -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME < "$BACKUP_FILE"

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se a restauração foi bem-sucedida
if [ $? -eq 0 ]; then
    echo "Restauração concluída com sucesso"
    
    #reiniciar-n8n-echo-reiniciando-n8n
    docker start n8n
    
    #log-da-restaurao-echo-date Restauração PostgreSQL concluída - $BACKUP_FILE" >> /var/log/n8n/restore.log
    
else
    echo "ERRO: Falha na restauração"
    exit 1
fi
```

#restaurao-de-workflows

#script-de-restaurao-de-workflows

```bash
#bin/bash
#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-restore-workflowssh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-n8nurlhttpsseu-n8ncom
API_KEY="sua_api_key"
BACKUP_FILE="$1"

if [ -z "$BACKUP_FILE" ]; then
    echo "Uso: $0 <arquivo_backup>"
    exit 1
fi

#ionicicon-namegrid-outline-style-fontsize-24px color: '#cor-ea4b71-verificar-se o arquivo existe
if [ ! -f "$BACKUP_FILE" ]; then
    echo "ERRO: Arquivo de backup não encontrado: $BACKUP_FILE"
    exit 1
fi

echo "Iniciando restauração de workflows..."

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-descomprimir-backup se necessário
if [[ "$BACKUP_FILE" == *.gz ]]; then
    echo "Descomprimindo backup..."
    gunzip -c "$BACKUP_FILE" > "${BACKUP_FILE%.gz}"
    BACKUP_FILE="${BACKUP_FILE%.gz}"
fi

#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-restaurar-workflows
echo "Restaurando workflows..."
jq -c '.[]' "$BACKUP_FILE" | while read workflow; do
    curl -X POST \
      -H "X-N8N-API-KEY: $API_KEY" \
      -H "Content-Type: application/json" \
      -d "$workflow" \
      "$N8N_URL/api/v1/workflows"
    
    if [ $? -eq 0 ]; then
        echo "Workflow restaurado com sucesso"
    else
        echo "ERRO: Falha na restauração do workflow"
    fi
done

echo "Restauração de workflows concluída"

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-log-da restauração
echo "$(date): Restauração de workflows concluída - $BACKUP_FILE" >> /var/log/n8n/restore.log
```

---

#ionicicon-namechevron-forward-outline-style-fontsize-24px color: '#cor-ea4b71-disaster-recovery

#plano-de-disaster-recovery

#cenrios-de-recuperao-bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-cenrios-de DR documentados
DR_SCENARIOS=(
    "Perda de servidor principal"
    "Corrupção de banco de dados"
    "Falha de storage"
    "Desastre natural"
    "Ataque cibernético"
    "Erro humano"
)
```

#rto-e-rpo-bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-objetivos-de Recuperação
RTO_PRIMARY=4      #id-4-horas-para-recuperao-rtosecondary24   #id-24-horas-para-recuperao-secundria
RPO_PRIMARY=1      #id-1-hora-de-perda-de dados máxima
RPO_SECONDARY=24   #id-24-horas-de-perda-de dados máxima
```

#recuperao-de-infraestrutura

#script-de-recuperao-completa-bash
#bin/bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-disaster-recoverysh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-primaryservern8n-primaryempresacom
BACKUP_SERVER="n8n-backup.empresa.com"
S3_BUCKET="n8n-backups"
LATEST_BACKUP=$(aws s3 ls s3://$S3_BUCKET/database/ | sort | tail -1 | awk '{print $4}')

echo "Iniciando Disaster Recovery..."

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-1-verificar conectividade
echo "Verificando conectividade..."
if ! ping -c 3 $PRIMARY_SERVER > /dev/null; then
    echo "Servidor primário indisponível, iniciando DR..."
    
    #id-2-provisionar-servidor-de-backup
    echo "Provisionando servidor de backup..."
    #aqui-voc-incluiria-comandos-para provisionar infraestrutura
    
    #id-3-restaurar-banco-de-dados
    echo "Restaurando banco de dados..."
    aws s3 cp s3://$S3_BUCKET/database/$LATEST_BACKUP /tmp/
    gunzip /tmp/$LATEST_BACKUP
    psql -h localhost -U n8n -d n8n < /tmp/${LATEST_BACKUP%.gz}
    
    #id-4-restaurar-workflows-echo-restaurando workflows..."
    aws s3 cp s3://$S3_BUCKET/workflows/ /tmp/workflows/ --recursive
    
    #id-5-configurar-dns-echo-atualizando DNS..."
    #comandos-para-atualizar-dns
    
    #id-6-verificar-funcionalidade-echo-verificando funcionalidade..."
    curl -f https://$BACKUP_SERVER/healthz
    
    if [ $? -eq 0 ]; then
        echo "Disaster Recovery concluído com sucesso"
        #notificar-equipe-curl-x-post $WEBHOOK_URL \
          -H "Content-type: application/json" \
          -d '{"text":"✅ Disaster Recovery concluído - n8n disponível em backup"}'
    else
        echo "ERRO: Falha no Disaster Recovery"
        exit 1
    fi
else
    echo "Servidor primário está funcionando"
fi
```

---

#ionicicon-namechevron-forward-outline-style-fontsize-24px color: '#cor-ea4b71-testes-de Restauração

#script-de-teste

#teste-automatizado-de-restaurao-bash
#bin/bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-test-restoresh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-testenvtest-restore
BACKUP_FILE="$1"
TEST_DB="n8n_test"

if [ -z "$BACKUP_FILE" ]; then
    echo "Uso: $0 <arquivo_backup>"
    exit 1
fi

echo "Iniciando teste de restauração..."

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-1-criar ambiente de teste
echo "Criando ambiente de teste..."
docker run -d --name $TEST_ENV \
  -e DB_TYPE=postgresdb \
  -e DB_POSTGRESDB_HOST=localhost \
  -e DB_POSTGRESDB_DATABASE=$TEST_DB \
  -p 5679:5678 \
  n8nio/n8n:latest

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-2-aguardar inicialização
echo "Aguardando inicialização..."
sleep 30

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-3-restaurar backup
echo "Restaurando backup de teste..."
gunzip -c "$BACKUP_FILE" | psql -h localhost -U n8n -d $TEST_DB

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-4-verificar restauração
echo "Verificando restauração..."
WORKFLOW_COUNT=$(curl -s http://localhost:5679/api/v1/workflows | jq '. | length')
echo "Workflows restaurados: $WORKFLOW_COUNT"

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-5-testar funcionalidade
echo "Testando funcionalidade..."
curl -f http://localhost:5679/healthz

if [ $? -eq 0 ]; then
    echo "✅ Teste de restauração PASSOU"
    #limpar-ambiente-de-teste-docker stop $TEST_ENV
    docker rm $TEST_ENV
    psql -h localhost -U n8n -c "DROP DATABASE $TEST_DB;"
else
    echo "❌ Teste de restauração FALHOU"
    exit 1
fi
```

---

#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-automao-com Cron

#configurao-de-cron-jobs

#crontab-configurao-bash
#ionicicon-nametime-outline-style-fontsize-24px color: '#cor-ea4b71-adicionar-ao crontab (crontab -e)

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-dirio às 2h da manhã
0 2 * * * /path/to/backup-postgres.sh

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-backup-semanal completo aos domingos às 3h
0 3 * * 0 /path/to/backup-complete.sh

#ionicicon-namegit-branch-outline-style-fontsize-24px color: '#cor-ea4b71-backup-de workflows a cada 6 horas
0 */6 * * * /path/to/backup-workflows.sh

#ionicicon-namecloud-outline-style-fontsize-24px color: '#cor-ea4b71-backup-para nuvem diário às 4h
0 4 * * * /path/to/backup-to-s3.sh

#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-teste-de restauração semanal aos sábados às 5h
0 5 * * 6 /path/to/test-restore.sh

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-limpeza-de backups antigos diariamente às 6h
0 6 * * * /path/to/cleanup-old-backups.sh
```

#script-de-limpeza-bash
#bin/bash
#ionicicon-namedocument-outline-style-fontsize-24px color: '#cor-ea4b71-cleanup-old-backupssh

#ionicicon-namekey-outline-style-fontsize-24px color: '#cor-ea4b71-configuraes-backupdirbackupsn8n
RETENTION_DAYS=30
CLOUD_RETENTION_DAYS=90

echo "Iniciando limpeza de backups antigos..."

#ionicicon-namesparkles-outline-style-fontsize-24px color: '#cor-ea4b71-limpar-backups locais
find $BACKUP_DIR -name "*.sql.gz" -mtime +$RETENTION_DAYS -delete
find $BACKUP_DIR -name "*.json.gz" -mtime +$RETENTION_DAYS -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +$RETENTION_DAYS -delete

#ionicicon-namecloud-outline-style-fontsize-24px color: '#cor-ea4b71-limpar-backups na nuvem (S3)
aws s3 ls s3://n8n-backups/ --recursive | \
  awk '$1 < "'$(date -d "$CLOUD_RETENTION_DAYS days ago" +%Y-%m-%d)'" {print $4}' | \
  xargs -I {} aws s3 rm s3://n8n-backups/{}

echo "Limpeza concluída"
```

---

#ionicicon-namechevron-forward-outline-style-fontsize-24px color: '#cor-ea4b71-checklist-de Backup

#configurao-estratgia 3-2-1 implementada
- [ ] Scripts de backup criados
- [ ] Automação com cron configurada
- [ ] Backup na nuvem configurado
- [ ] Retenção de backups definida

#recuperao-scripts de restauração criados
- [ ] Testes de restauração realizados
- [ ] Plano de DR documentado
- [ ] RTO e RPO definidos
- [ ] Procedimentos de recuperação testados

#monitoramento-logs de backup configurados
- [ ] Alertas de falha configurados
- [ ] Métricas de backup coletadas
- [ ] Relatórios de backup gerados
- [ ] Verificação de integridade implementada

#documentao-procedimentos documentados
- [ ] Contatos de emergência definidos
- [ ] Matriz de responsabilidades
- [ ] Plano de comunicação
- [ ] Exercícios de DR realizados

---

#ionicicon-namearrow-forward-circle-outline-style-fontsize-24px color: '#cor-ea4b71-prximos-passos

Agora que você implementou backup e recovery:

1. **[Monitoramento](./monitoring)** - Configure alertas e métricas
2. **[Autenticação](./autenticacao)** - Configure métodos de login seguros
3. **[Usuários e Permissões](./usuarios-permissoes)** - Configure controle de acesso

---

:::tip **Dica Pro**
Teste regularmente seus backups restaurando-os em ambiente de teste. Um backup que não pode ser restaurado é inútil.
:::

:::warning **Importante**
Mantenha pelo menos uma cópia dos backups fora do local principal e teste a recuperação pelo menos mensalmente.
:::

:::info **Recurso Adicional**
Considere implementar backup contínuo (continuous backup) para sistemas críticos que não podem perder dados.
:::

---

**Links úteis:**

- [Documentação oficial n8n](https://docs.n8n.io/)
- [Backup e Restore n8n](https://docs.n8n.io/hosting/backup-restore/)
- [Segurança n8n](https://docs.n8n.io/hosting/security/)

